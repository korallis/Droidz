{
  "hooks": {
    "SessionStart": [
      {
        "name": "load-project-context",
        "type": "prompt",
        "prompt": "Load project context by:\n1. Checking if tech stack has been analyzed\n2. Loading organization memory if available\n3. Verifying all CLAUDE.md standards are accessible\n4. Reporting current project setup\n\nIf tech stack not analyzed, suggest running /analyze-tech-stack"
      },
      {
        "name": "specialist-routing-system",
        "type": "prompt",
        "prompt": "ðŸ¤– DROIDZ SPECIALIST ROUTING SYSTEM ðŸ¤–\n\nThis project uses the Droidz framework with 10+ specialized AI agents. Your PRIMARY job is to ROUTE tasks to the right specialist, not handle them yourself.\n\n## ROUTING DECISION TREE (Check FIRST for every request)\n\nUser mentions:\n- \"UI\", \"component\", \"style\", \"design system\", \"button\", \"form\", \"modal\", \"card\" â†’ droidz-ui-designer\n- \"UX\", \"user flow\", \"journey\", \"experience\", \"onboarding\", \"usability\" â†’ droidz-ux-designer\n- \"database\", \"schema\", \"query\", \"SQL\", \"migration\", \"index\", \"table\" â†’ droidz-database-architect\n- \"API design\", \"endpoint spec\", \"REST\", \"GraphQL\", \"API docs\" â†’ droidz-api-designer\n- \"integrate\", \"external API\", \"Stripe\", \"Twilio\", \"webhook\", \"OAuth\" â†’ droidz-integration\n- \"test\", \"coverage\", \"QA\", \"unit test\", \"E2E\", \"integration test\" â†’ droidz-test\n- \"refactor\", \"clean up\", \"tech debt\", \"code quality\", \"restructure\" â†’ droidz-refactor\n- \"security\", \"audit\", \"vulnerability\", \"OWASP\", \"XSS\", \"SQL injection\" â†’ droidz-security-auditor\n- \"performance\", \"optimize\", \"slow query\", \"bundle size\", \"profile\" â†’ droidz-performance-optimizer\n- \"accessibility\", \"a11y\", \"WCAG\", \"screen reader\", \"ARIA\", \"keyboard nav\" â†’ droidz-accessibility-specialist\n- \"CI/CD\", \"pipeline\", \"GitHub Actions\", \"Docker\", \"deploy\", \"build\" â†’ droidz-infra\n- Complex feature with 3+ components (API + UI + tests) â†’ droidz-orchestrator\n- Feature implementation or bug fix â†’ droidz-codegen\n- Unclear/mixed domains â†’ droidz-generalist\n\n## CRITICAL RULES\n\n1. **ALWAYS delegate to specialists** - Don't handle their work yourself\n2. **Check routing tree FIRST** - Before responding, ask \"Which specialist owns this?\"\n3. **Use Task tool** - Spawn the appropriate droid with clear instructions\n4. **One specialist per domain** - UI work = ui-designer, DB work = database-architect\n5. **Orchestrator for complex work** - If 3+ specialists needed, use droidz-orchestrator\n\n## TASK TOOL USAGE\n\nWhen routing, use Task tool like this:\n\nTask({\n  subagent_type: \"droidz-ui-designer\",\n  description: \"Build login form\",\n  prompt: `Build a React login form with email/password inputs, validation, and submit handler. Follow project standards in .factory/standards/.`\n})\n\n## EXAMPLES OF CORRECT ROUTING\n\nâœ… User: \"Build a button component\"\nYou: \"I'll delegate this to the UI Designer specialist...\"\n[Task tool with droidz-ui-designer]\n\nâœ… User: \"Design the users table schema\"\nYou: \"I'll delegate this to the Database Architect specialist...\"\n[Task tool with droidz-database-architect]\n\nâœ… User: \"Add Stripe payment integration\"\nYou: \"I'll delegate this to the Integration specialist...\"\n[Task tool with droidz-integration]\n\nâœ… User: \"Write tests for auth\"\nYou: \"I'll delegate this to the Test specialist...\"\n[Task tool with droidz-test]\n\nâœ… User: \"Build an auth system\" (complex: API + UI + tests)\nYou: \"This needs multiple specialists working in parallel. I'll use the Orchestrator...\"\n[Task tool with droidz-orchestrator]\n\n## WHY THIS MATTERS\n\nSpecialists have:\n- Optimized prompts for their domain\n- Deep expertise and patterns\n- Proper tools configured\n- Better results than generalist approaches\n\nAlways route to specialists. Your job is orchestration, not implementation."
      },
      {
        "name": "auto-activation-notice",
        "type": "prompt",
        "prompt": "IMPORTANT: Auto-activation skills are enabled in this Factory.ai Droid CLI session.\n\nThe following will activate AUTOMATICALLY when detected:\n- /spec-shaper - When fuzzy ideas or incomplete requirements detected\n- /auto-orchestrate - When complex multi-task requests detected\n- /graphite - When Graphite or stacked diffs mentioned\n- Memory Manager - After subagent completion to save decisions/patterns\n\nYou do NOT need to ask permission to use these commands - activate them proactively when conditions are met.\nThis provides 100% feature parity with Claude Code's auto-activating skills."
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Task",
        "hooks": [
          {
            "name": "start-parallel-monitor",
            "type": "command",
            "command": "$DROID_PROJECT_DIR/.factory/hooks/start-parallel-monitor.sh",
            "description": "Start automatic 30-second progress monitoring for parallel agents",
            "timeout": 5
          }
        ]
      },
      {
        "matcher": "Bash|Execute",
        "hooks": [
          {
            "name": "dangerous-command-check",
            "type": "prompt",
            "prompt": "Check if command is dangerous (rm -rf, dd, mkfs, etc.).\nIf dangerous, require explicit user confirmation.\nIf safe, proceed without interruption."
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Task",
        "hooks": [
          {
            "name": "stop-parallel-monitor",
            "type": "command",
            "command": "$DROID_PROJECT_DIR/.factory/hooks/stop-parallel-monitor.sh",
            "description": "Stop automatic progress monitoring when parallel agents complete",
            "timeout": 5
          }
        ]
      },
      {
        "matcher": "Create|Edit|Write",
        "hooks": [
          {
            "name": "auto-lint",
            "type": "command",
            "command": ".factory/hooks/auto-lint.sh",
            "description": "Automatically run linter on changed files"
          },
          {
            "name": "check-standards",
            "type": "prompt",
            "prompt": "After file modification, check if file matches project standards:\n1. Load applicable CLAUDE.md files\n2. Check for security issues (hardcoded secrets, SQL injection, etc.)\n3. If critical issues found, report immediately\n4. For non-critical issues, queue for next review"
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "name": "check-specialist-routing",
        "type": "prompt",
        "prompt": "ðŸŽ¯ ROUTING CHECK (MANDATORY)\n\nBefore responding, ask yourself:\n1. Does this request involve UI/components/styling? â†’ droidz-ui-designer\n2. Does this request involve UX/user flows? â†’ droidz-ux-designer\n3. Does this request involve database/schema/queries? â†’ droidz-database-architect\n4. Does this request involve API design/endpoints? â†’ droidz-api-designer\n5. Does this request involve external integrations? â†’ droidz-integration\n6. Does this request involve testing/coverage? â†’ droidz-test\n7. Does this request involve refactoring/cleanup? â†’ droidz-refactor\n8. Does this request involve security/auditing? â†’ droidz-security-auditor\n9. Does this request involve performance tuning? â†’ droidz-performance-optimizer\n10. Does this request involve accessibility? â†’ droidz-accessibility-specialist\n11. Does this request involve CI/CD/deployment? â†’ droidz-infra\n12. Is this a complex feature with 3+ components? â†’ droidz-orchestrator\n\nIf YES to any: Use Task tool to delegate to that specialist.\nIf NO to all: You can handle it directly OR use droidz-generalist for unclear cases.\n\nDO NOT implement UI, database, API, test, or infra work yourself - always delegate!"
      },
      {
        "name": "context-usage-monitor",
        "type": "command",
        "command": ".factory/hooks/monitor-context.sh",
        "description": "Monitor context window usage and suggest optimization if >70%"
      },
      {
        "name": "auto-activate-spec-shaper",
        "type": "prompt",
        "prompt": "PROACTIVELY detect if user has fuzzy ideas or incomplete requirements:\n- User mentions 'build', 'create', 'add feature' without clear details\n- Request lacks specific requirements or acceptance criteria\n- User asks for help planning or designing something\n- Idea needs clarification before implementation\n\nIf detected, AUTOMATICALLY use /spec-shaper command (do NOT ask permission):\n- Guide user through specification creation\n- Ask clarifying questions about requirements\n- Help define acceptance criteria\n- Create structured spec file\n\nActivate silently and proactively - this is auto-activation, not a suggestion."
      },
      {
        "name": "auto-activate-orchestrator",
        "type": "prompt",
        "prompt": "PROACTIVELY detect complex multi-task requests:\n- Request mentions 3+ distinct components or features\n- Multiple independent areas of work (frontend + backend + tests + infra)\n- User explicitly mentions parallel work or orchestration\n- Task estimated >2 hours with parallelizable components\n- Request involves different specialist domains\n\nIf detected, AUTOMATICALLY use /auto-orchestrate command (do NOT ask permission):\n- Analyze task complexity\n- Recommend orchestration approach\n- Break down into parallel tasks\n- Generate tasks.json if appropriate\n\nActivate silently and proactively - this is auto-activation, not a suggestion."
      },
      {
        "name": "auto-activate-graphite",
        "type": "prompt",
        "prompt": "PROACTIVELY detect Graphite stacked diffs usage:\n- User mentions 'stacked diffs', 'stacked PRs', 'Graphite', or 'gt' command\n- User asks about managing dependent pull requests\n- User wants to break large work into reviewable chunks\n- Context suggests multi-PR workflow needed\n\nIf detected, AUTOMATICALLY use /graphite command (do NOT ask permission):\n- Provide Graphite workflow guidance\n- Show relevant gt commands\n- Help with stack management\n- Guide through PR creation and syncing\n\nActivate silently and proactively - this is auto-activation, not a suggestion."
      }
    ],
    "SubagentStop": [
      {
        "name": "update-linear-ticket",
        "type": "prompt",
        "prompt": "If Linear MCP is available and task relates to a ticket:\n1. Check if PR was created\n2. Update ticket status to 'In Review' or 'Done'\n3. Add PR link as comment\n4. Update TodoWrite progress"
      },
      {
        "name": "auto-activate-memory-manager",
        "type": "prompt",
        "prompt": "PROACTIVELY detect and save important context after subagent completion:\n\nAUTOMATICALLY save to organization memory if:\n- Architectural decisions made (framework choices, patterns, structure)\n- Technical decisions (library selections, API designs, data models)\n- Project standards established\n- Build/deployment configurations chosen\n\nAUTOMATICALLY save to pattern library if:\n- New code pattern discovered or created\n- Reusable solution implemented\n- Best practice identified\n- Framework-specific pattern used\n\nAUTOMATICALLY save to user memory if:\n- User preferences expressed\n- Workflow preferences shown\n- Tool preferences indicated\n- Coding style preferences revealed\n\nUse /save-decision command for important decisions.\nActivate silently and proactively - this is auto-activation, not a suggestion.\n\nExample:\n- Decision: 'We chose PostgreSQL over MySQL for better JSON support'\n- Pattern: 'Repository pattern for database access'\n- Preference: 'User prefers TypeScript strict mode'"
      }
    ],
    "Notification": [
      {
        "matcher": "error|failed|exception",
        "hooks": [
          {
            "name": "error-analysis",
            "type": "prompt",
            "prompt": "When error notification received:\n1. Analyze error message and stack trace\n2. Check if similar error seen before (in memory)\n3. Suggest fix based on standards and patterns\n4. Save error pattern if novel"
          }
        ]
      }
    ],
    "Stop": [
      {
        "name": "session-summary",
        "type": "prompt",
        "prompt": "Before ending session:\n1. Summarize what was accomplished\n2. Note any incomplete tasks\n3. Save important decisions to memory\n4. Suggest next steps"
      }
    ]
  },
  "contextManagement": {
    "autoOptimize": true,
    "optimizationThreshold": 0.70,
    "aggressiveThreshold": 0.90,
    "createCheckpoints": true
  },
  "standards": {
    "enforcement": {
      "security": "block",
      "typescript": "warn",
      "performance": "suggest",
      "style": "auto-fix"
    },
    "autoFix": {
      "enabled": true,
      "requireApproval": false
    }
  },
  "memory": {
    "autoSave": true,
    "saveDecisions": true,
    "savePatterns": true,
    "savePreferences": true
  }
}
